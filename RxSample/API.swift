//
//  API.swift
//  RxSample
//
//  Created by Calvin on 10/13/16.
//  Copyright Â© 2016 CapsLock. All rights reserved.
//

import Moya

let endpointClosure = { (target: GitHub) -> Endpoint<GitHub> in
    let url = target.baseURL.appendingPathComponent(target.path).absoluteString
    let endpoint: Endpoint<GitHub> = Endpoint<GitHub>(URL: url, sampleResponseClosure: {.networkResponse(200, target.sampleData)}, method: target.method, parameters: target.parameters)
    
    // Sign all non-authenticating requests
    switch target {
//    case .userBooks, .user:
//        return endpoint.adding(newHttpHeaderFields: ["Authentication-Token": UserViewModel.sharedInstance.token ?? ""])
    default:
        return endpoint
    }
}

let GitHubProvider = RxMoyaProvider<GitHub>(endpointClosure: endpointClosure, plugins:  [NetworkLoggerPlugin(verbose: true)])

enum GitHub {
    case searchRepo(String)
}

extension GitHub: TargetType {
    public var baseURL: URL { return URL(string: Application.AssociatedDomain.current.value)! }
    public var path: String {
        switch self {
        case .searchRepo(let query):
            return "/search/repositories?q=\(query)"
        }
        
    }
    public var method: Moya.Method {
        return .GET
    }
    public var parameters: [String: Any]? {
        switch self {
        case .searchRepo:
            return nil
        }
    }
    public var task: Task {
        return .request
    }
    
    public var sampleData: Data {
        switch self {
        case .searchRepo:
            return "{\n  \"total_count\": 8258,\n  \"incomplete_results\": false,\n  \"items\": [\n    {\n      \"id\": 75739,\n      \"name\": \"Rx\",\n      \"full_name\": \"rjbs/Rx\",\n      \"owner\": {\n        \"login\": \"rjbs\",\n        \"id\": 30682,\n        \"avatar_url\": \"https://avatars.githubusercontent.com/u/30682?v=3\",\n        \"gravatar_id\": \"\",\n        \"url\": \"https://api.github.com/users/rjbs\",\n        \"html_url\": \"https://github.com/rjbs\",\n        \"followers_url\": \"https://api.github.com/users/rjbs/followers\",\n        \"following_url\": \"https://api.github.com/users/rjbs/following{/other_user}\",\n        \"gists_url\": \"https://api.github.com/users/rjbs/gists{/gist_id}\",\n        \"starred_url\": \"https://api.github.com/users/rjbs/starred{/owner}{/repo}\",\n        \"subscriptions_url\": \"https://api.github.com/users/rjbs/subscriptions\",\n        \"organizations_url\": \"https://api.github.com/users/rjbs/orgs\",\n        \"repos_url\": \"https://api.github.com/users/rjbs/repos\",\n        \"events_url\": \"https://api.github.com/users/rjbs/events{/privacy}\",\n        \"received_events_url\": \"https://api.github.com/users/rjbs/received_events\",\n        \"type\": \"User\",\n        \"site_admin\": false\n      },\n      \"private\": false,\n      \"html_url\": \"https://github.com/rjbs/Rx\",\n      \"description\": \"the Rx schema and validation system\",\n      \"fork\": false,\n      \"url\": \"https://api.github.com/repos/rjbs/Rx\",\n      \"forks_url\": \"https://api.github.com/repos/rjbs/Rx/forks\",\n      \"keys_url\": \"https://api.github.com/repos/rjbs/Rx/keys{/key_id}\",\n      \"collaborators_url\": \"https://api.github.com/repos/rjbs/Rx/collaborators{/collaborator}\",\n      \"teams_url\": \"https://api.github.com/repos/rjbs/Rx/teams\",\n      \"hooks_url\": \"https://api.github.com/repos/rjbs/Rx/hooks\",\n      \"issue_events_url\": \"https://api.github.com/repos/rjbs/Rx/issues/events{/number}\",\n      \"events_url\": \"https://api.github.com/repos/rjbs/Rx/events\",\n      \"assignees_url\": \"https://api.github.com/repos/rjbs/Rx/assignees{/user}\",\n      \"branches_url\": \"https://api.github.com/repos/rjbs/Rx/branches{/branch}\",\n      \"tags_url\": \"https://api.github.com/repos/rjbs/Rx/tags\",\n      \"blobs_url\": \"https://api.github.com/repos/rjbs/Rx/git/blobs{/sha}\",\n      \"git_tags_url\": \"https://api.github.com/repos/rjbs/Rx/git/tags{/sha}\",\n      \"git_refs_url\": \"https://api.github.com/repos/rjbs/Rx/git/refs{/sha}\",\n      \"trees_url\": \"https://api.github.com/repos/rjbs/Rx/git/trees{/sha}\",\n      \"statuses_url\": \"https://api.github.com/repos/rjbs/Rx/statuses/{sha}\",\n      \"languages_url\": \"https://api.github.com/repos/rjbs/Rx/languages\",\n      \"stargazers_url\": \"https://api.github.com/repos/rjbs/Rx/stargazers\",\n      \"contributors_url\": \"https://api.github.com/repos/rjbs/Rx/contributors\",\n      \"subscribers_url\": \"https://api.github.com/repos/rjbs/Rx/subscribers\",\n      \"subscription_url\": \"https://api.github.com/repos/rjbs/Rx/subscription\",\n      \"commits_url\": \"https://api.github.com/repos/rjbs/Rx/commits{/sha}\",\n      \"git_commits_url\": \"https://api.github.com/repos/rjbs/Rx/git/commits{/sha}\",\n      \"comments_url\": \"https://api.github.com/repos/rjbs/Rx/comments{/number}\",\n      \"issue_comment_url\": \"https://api.github.com/repos/rjbs/Rx/issues/comments{/number}\",\n      \"contents_url\": \"https://api.github.com/repos/rjbs/Rx/contents/{+path}\",\n      \"compare_url\": \"https://api.github.com/repos/rjbs/Rx/compare/{base}...{head}\",\n      \"merges_url\": \"https://api.github.com/repos/rjbs/Rx/merges\",\n      \"archive_url\": \"https://api.github.com/repos/rjbs/Rx/{archive_format}{/ref}\",\n      \"downloads_url\": \"https://api.github.com/repos/rjbs/Rx/downloads\",\n      \"issues_url\": \"https://api.github.com/repos/rjbs/Rx/issues{/number}\",\n      \"pulls_url\": \"https://api.github.com/repos/rjbs/Rx/pulls{/number}\",\n      \"milestones_url\": \"https://api.github.com/repos/rjbs/Rx/milestones{/number}\",\n      \"notifications_url\": \"https://api.github.com/repos/rjbs/Rx/notifications{?since,all,participating}\",\n      \"labels_url\": \"https://api.github.com/repos/rjbs/Rx/labels{/name}\",\n      \"releases_url\": \"https://api.github.com/repos/rjbs/Rx/releases{/id}\",\n      \"deployments_url\": \"https://api.github.com/repos/rjbs/Rx/deployments\",\n      \"created_at\": \"2008-11-14T03:57:43Z\",\n      \"updated_at\": \"2016-09-23T20:20:29Z\",\n      \"pushed_at\": \"2016-01-04T02:48:42Z\",\n      \"git_url\": \"git://github.com/rjbs/Rx.git\",\n      \"ssh_url\": \"git@github.com:rjbs/Rx.git\",\n      \"clone_url\": \"https://github.com/rjbs/Rx.git\",\n      \"svn_url\": \"https://github.com/rjbs/Rx\",\n      \"homepage\": \"http://rjbs.manxome.org/rx\",\n      \"size\": 711,\n      \"stargazers_count\": 112,\n      \"watchers_count\": 112,\n      \"language\": \"JavaScript\",\n      \"has_issues\": true,\n      \"has_downloads\": false,\n      \"has_wiki\": false,\n      \"has_pages\": false,\n      \"forks_count\": 33,\n      \"mirror_url\": null,\n      \"open_issues_count\": 3,\n      \"forks\": 33,\n      \"open_issues\": 3,\n      \"watchers\": 112,\n      \"default_branch\": \"master\",\n      \"score\": 87.619965\n    },\n    {\n      \"id\": 6658176,\n      \"name\": \"rx\",\n      \"full_name\": \"atsushieno/rx\",\n      \"owner\": {\n        \"login\": \"atsushieno\",\n        \"id\": 53929,\n        \"avatar_url\": \"https://avatars.githubusercontent.com/u/53929?v=3\",\n        \"gravatar_id\": \"\",\n        \"url\": \"https://api.github.com/users/atsushieno\",\n        \"html_url\": \"https://github.com/atsushieno\",\n        \"followers_url\": \"https://api.github.com/users/atsushieno/followers\",\n        \"following_url\": \"https://api.github.com/users/atsushieno/following{/other_user}\",\n        \"gists_url\": \"https://api.github.com/users/atsushieno/gists{/gist_id}\",\n        \"starred_url\": \"https://api.github.com/users/atsushieno/starred{/owner}{/repo}\",\n        \"subscriptions_url\": \"https://api.github.com/users/atsushieno/subscriptions\",\n        \"organizations_url\": \"https://api.github.com/users/atsushieno/orgs\",\n        \"repos_url\": \"https://api.github.com/users/atsushieno/repos\",\n        \"events_url\": \"https://api.github.com/users/atsushieno/events{/privacy}\",\n        \"received_events_url\": \"https://api.github.com/users/atsushieno/received_events\",\n        \"type\": \"User\",\n        \"site_admin\": false\n      },\n      \"private\": false,\n      \"html_url\": \"https://github.com/atsushieno/rx\",\n      \"description\": \"copied and shrinked clone of rx.codeplex.com\",\n      \"fork\": false,\n      \"url\": \"https://api.github.com/repos/atsushieno/rx\",\n      \"forks_url\": \"https://api.github.com/repos/atsushieno/rx/forks\",\n      \"keys_url\": \"https://api.github.com/repos/atsushieno/rx/keys{/key_id}\",\n      \"collaborators_url\": \"https://api.github.com/repos/atsushieno/rx/collaborators{/collaborator}\",\n      \"teams_url\": \"https://api.github.com/repos/atsushieno/rx/teams\",\n      \"hooks_url\": \"https://api.github.com/repos/atsushieno/rx/hooks\",\n      \"issue_events_url\": \"https://api.github.com/repos/atsushieno/rx/issues/events{/number}\",\n      \"events_url\": \"https://api.github.com/repos/atsushieno/rx/events\",\n      \"assignees_url\": \"https://api.github.com/repos/atsushieno/rx/assignees{/user}\",\n      \"branches_url\": \"https://api.github.com/repos/atsushieno/rx/branches{/branch}\",\n      \"tags_url\": \"https://api.github.com/repos/atsushieno/rx/tags\",\n      \"blobs_url\": \"https://api.github.com/repos/atsushieno/rx/git/blobs{/sha}\",\n      \"git_tags_url\": \"https://api.github.com/repos/atsushieno/rx/git/tags{/sha}\",\n      \"git_refs_url\": \"https://api.github.com/repos/atsushieno/rx/git/refs{/sha}\",\n      \"trees_url\": \"https://api.github.com/repos/atsushieno/rx/git/trees{/sha}\",\n      \"statuses_url\": \"https://api.github.com/repos/atsushieno/rx/statuses/{sha}\",\n      \"languages_url\": \"https://api.github.com/repos/atsushieno/rx/languages\",\n      \"stargazers_url\": \"https://api.github.com/repos/atsushieno/rx/stargazers\",\n      \"contributors_url\": \"https://api.github.com/repos/atsushieno/rx/contributors\",\n      \"subscribers_url\": \"https://api.github.com/repos/atsushieno/rx/subscribers\",\n      \"subscription_url\": \"https://api.github.com/repos/atsushieno/rx/subscription\",\n      \"commits_url\": \"https://api.github.com/repos/atsushieno/rx/commits{/sha}\",\n      \"git_commits_url\": \"https://api.github.com/repos/atsushieno/rx/git/commits{/sha}\",\n      \"comments_url\": \"https://api.github.com/repos/atsushieno/rx/comments{/number}\",\n      \"issue_comment_url\": \"https://api.github.com/repos/atsushieno/rx/issues/comments{/number}\",\n      \"contents_url\": \"https://api.github.com/repos/atsushieno/rx/contents/{+path}\",\n      \"compare_url\": \"https://api.github.com/repos/atsushieno/rx/compare/{base}...{head}\",\n      \"merges_url\": \"https://api.github.com/repos/atsushieno/rx/merges\",\n      \"archive_url\": \"https://api.github.com/repos/atsushieno/rx/{archive_format}{/ref}\",\n      \"downloads_url\": \"https://api.github.com/repos/atsushieno/rx/downloads\",\n      \"issues_url\": \"https://api.github.com/repos/atsushieno/rx/issues{/number}\",\n      \"pulls_url\": \"https://api.github.com/repos/atsushieno/rx/pulls{/number}\",\n      \"milestones_url\": \"https://api.github.com/repos/atsushieno/rx/milestones{/number}\",\n      \"notifications_url\": \"https://api.github.com/repos/atsushieno/rx/notifications{?since,all,participating}\",\n      \"labels_url\": \"https://api.github.com/repos/atsushieno/rx/labels{/name}\",\n      \"releases_url\": \"https://api.github.com/repos/atsushieno/rx/releases{/id}\",\n      \"deployments_url\": \"https://api.github.com/repos/atsushieno/rx/deployments\",\n      \"created_at\": \"2012-11-12T18:21:19Z\",\n      \"updated_at\": \"2015-02-03T22:02:36Z\",\n      \"pushed_at\": \"2012-11-12T19:10:30Z\",\n      \"git_url\": \"git://github.com/atsushieno/rx.git\",\n      \"ssh_url\": \"git@github.com:atsushieno/rx.git\",\n      \"clone_url\": \"https://github.com/atsushieno/rx.git\",\n      \"svn_url\": \"https://github.com/atsushieno/rx\",\n      \"homepage\": null,\n      \"size\": 708,\n      \"stargazers_count\": 3,\n      \"watchers_count\": 3,\n      \"language\": \"Shell\",\n      \"has_issues\": true,\n      \"has_downloads\": true,\n      \"has_wiki\": true,\n      \"has_pages\": false,\n      \"forks_count\": 9,\n      \"mirror_url\": null,\n      \"open_issues_count\": 1,\n      \"forks\": 9,\n      \"open_issues\": 1,\n      \"watchers\": 3,\n      \"default_branch\": \"master\",\n      \"score\": 48.736546\n    },\n    {\n      \"id\": 4100638,\n      \"name\": \"rx\",\n      \"full_name\": \"kylelemons/rx\",\n      \"owner\": {\n        \"login\": \"kylelemons\",\n        \"id\": 322213,\n        \"avatar_url\": \"https://avatars.githubusercontent.com/u/322213?v=3\",\n        \"gravatar_id\": \"\",\n        \"url\": \"https://api.github.com/users/kylelemons\",\n        \"html_url\": \"https://github.com/kylelemons\",\n        \"followers_url\": \"https://api.github.com/users/kylelemons/followers\",\n        \"following_url\": \"https://api.github.com/users/kylelemons/following{/other_user}\",\n        \"gists_url\": \"https://api.github.com/users/kylelemons/gists{/gist_id}\",\n        \"starred_url\": \"https://api.github.com/users/kylelemons/starred{/owner}{/repo}\",\n        \"subscriptions_url\": \"https://api.github.com/users/kylelemons/subscriptions\",\n        \"organizations_url\": \"https://api.github.com/users/kylelemons/orgs\",\n        \"repos_url\": \"https://api.github.com/users/kylelemons/repos\",\n        \"events_url\": \"https://api.github.com/users/kylelemons/events{/privacy}\",\n        \"received_events_url\": \"https://api.github.com/users/kylelemons/received_events\",\n        \"type\": \"User\",\n        \"site_admin\": false\n      },\n      \"private\": false,\n      \"html_url\": \"https://github.com/kylelemons/rx\",\n      \"description\": \"Rx is my prescription for your Go dependency update headaches\",\n      \"fork\": false,\n      \"url\": \"https://api.github.com/repos/kylelemons/rx\",\n      \"forks_url\": \"https://api.github.com/repos/kylelemons/rx/forks\",\n      \"keys_url\": \"https://api.github.com/repos/kylelemons/rx/keys{/key_id}\",\n      \"collaborators_url\": \"https://api.github.com/repos/kylelemons/rx/collaborators{/collaborator}\",\n      \"teams_url\": \"https://api.github.com/repos/kylelemons/rx/teams\",\n      \"hooks_url\": \"https://api.github.com/repos/kylelemons/rx/hooks\",\n      \"issue_events_url\": \"https://api.github.com/repos/kylelemons/rx/issues/events{/number}\",\n      \"events_url\": \"https://api.github.com/repos/kylelemons/rx/events\",\n      \"assignees_url\": \"https://api.github.com/repos/kylelemons/rx/assignees{/user}\",\n      \"branches_url\": \"https://api.github.com/repos/kylelemons/rx/branches{/branch}\",\n      \"tags_url\": \"https://api.github.com/repos/kylelemons/rx/tags\",\n      \"blobs_url\": \"https://api.github.com/repos/kylelemons/rx/git/blobs{/sha}\",\n      \"git_tags_url\": \"https://api.github.com/repos/kylelemons/rx/git/tags{/sha}\",\n      \"git_refs_url\": \"https://api.github.com/repos/kylelemons/rx/git/refs{/sha}\",\n      \"trees_url\": \"https://api.github.com/repos/kylelemons/rx/git/trees{/sha}\",\n      \"statuses_url\": \"https://api.github.com/repos/kylelemons/rx/statuses/{sha}\",\n      \"languages_url\": \"https://api.github.com/repos/kylelemons/rx/languages\",\n      \"stargazers_url\": \"https://api.github.com/repos/kylelemons/rx/stargazers\",\n      \"contributors_url\": \"https://api.github.com/repos/kylelemons/rx/contributors\",\n      \"subscribers_url\": \"https://api.github.com/repos/kylelemons/rx/subscribers\",\n      \"subscription_url\": \"https://api.github.com/repos/kylelemons/rx/subscription\",\n      \"commits_url\": \"https://api.github.com/repos/kylelemons/rx/commits{/sha}\",\n      \"git_commits_url\": \"https://api.github.com/repos/kylelemons/rx/git/commits{/sha}\",\n      \"comments_url\": \"https://api.github.com/repos/kylelemons/rx/comments{/number}\",\n      \"issue_comment_url\": \"https://api.github.com/repos/kylelemons/rx/issues/comments{/number}\",\n      \"contents_url\": \"https://api.github.com/repos/kylelemons/rx/contents/{+path}\",\n      \"compare_url\": \"https://api.github.com/repos/kylelemons/rx/compare/{base}...{head}\",\n      \"merges_url\": \"https://api.github.com/repos/kylelemons/rx/merges\",\n      \"archive_url\": \"https://api.github.com/repos/kylelemons/rx/{archive_format}{/ref}\",\n      \"downloads_url\": \"https://api.github.com/repos/kylelemons/rx/downloads\",\n      \"issues_url\": \"https://api.github.com/repos/kylelemons/rx/issues{/number}\",\n      \"pulls_url\": \"https://api.github.com/repos/kylelemons/rx/pulls{/number}\",\n      \"milestones_url\": \"https://api.github.com/repos/kylelemons/rx/milestones{/number}\",\n      \"notifications_url\": \"https://api.github.com/repos/kylelemons/rx/notifications{?since,all,participating}\",\n      \"labels_url\": \"https://api.github.com/repos/kylelemons/rx/labels{/name}\",\n      \"releases_url\": \"https://api.github.com/repos/kylelemons/rx/releases{/id}\",\n      \"deployments_url\": \"https://api.github.com/repos/kylelemons/rx/deployments\",\n      \"created_at\": \"2012-04-22T00:27:54Z\",\n      \"updated_at\": \"2016-06-09T11:51:05Z\",\n      \"pushed_at\": \"2013-09-02T08:47:34Z\",\n      \"git_url\": \"git://github.com/kylelemons/rx.git\",\n      \"ssh_url\": \"git@github.com:kylelemons/rx.git\",\n      \"clone_url\": \"https://github.com/kylelemons/rx.git\",\n      \"svn_url\": \"https://github.com/kylelemons/rx\",\n      \"homepage\": \"http://go.pkgdoc.org/github.com/kylelemons/rx\",\n      \"size\": 140,\n      \"stargazers_count\": 20,\n      \"watchers_count\": 20,\n      \"language\": \"Go\",\n      \"has_issues\": true,\n      \"has_downloads\": true,\n      \"has_wiki\": true,\n      \"has_pages\": false,\n      \"forks_count\": 3,\n      \"mirror_url\": null,\n      \"open_issues_count\": 1,\n      \"forks\": 3,\n      \"open_issues\": 1,\n      \"watchers\": 20,\n      \"default_branch\": \"master\",\n      \"score\": 44.430546\n    }\n]}".data(using: .utf8)!
        default:
            return "".data(using: .utf8)!
        }
    }
}
